<html>
    <head>
        <link rel="stylesheet" type="text/css" href="gameComponents/accountManagmentScreen.css">
        <script>
            $("document").ready(function(){
                //firstly don't show the div
                $("#overlay").fadeOut(0);
                $("#wrapper").fadeOut(0);
                //load all data
                var formdata = false;

                if (window.FormData) {
                    formdata = new FormData();
                }
                $("#avatarImage").attr("src",window._userAvatarSrc);
                
                //set handlers
                $("#hideOverlayButton").click(hideOverlay);
                $("#avatarSelector").change(function() { 
                    if (formdata) {
                        if (this.files[0].size > 1048576 || this.files.length > 1){
                            alert("Please upload one file which is not greater than 2MiB"); 
                        }else{
                            formdata.append("MAX_FILE_SIZE","1048576");
                            formdata.append("userfile[]", this.files[0]);
                            formdata.append("action","uploadAvatar");
                            // select the form and submit
                            $("#avatarUploaderForm").submit();
                        }
                    }
                    
                    
                });
                
                $("#avatarUploaderForm").submit(function(evt){
                    evt.preventDefault();

                    //send form
                    if (formdata) {
                    $.ajax({
                        url: "restricted/performAction.php",
                        method: "POST",
                        data: formdata,
                        processData: false,
                        contentType: false,
                        dataType: "json",
                        success: function (response) {
                          console.log(response);
                            if (response["success"]==true){
                                loadAvatar();
                            }else{
                                alert(response["error"],response["errorCode"]);   
                            }
                        },
                        error:logError
                      });
                    }
                    
                });
                //fade back in
                $("#overlay").fadeTo(500,0.9);
                $("#wrapper").fadeIn(500);
            });
            
            function hideOverlay(evt){
                $("#wrapper").fadeOut(100,function(){
                    removeElement("accountManagmentScreen")
                });
                
            }
            
            function loadAvatar(){
                fetchUserAvatar(setAvatar);
            }
            
        </script>
    </head>
    <body>
        <div id="wrapper">
            <div id="overlay"></div>
            <div id="avatarImageContainer">
                <img id="avatarImage" class = "userAvatar" src="restricted/images/avatars/defaultAvatar.png">
                <form id="avatarUploaderForm" enctype="multipart/form-data" method="POST" action="restrcted/performAction.php">
                    <input type="hidden" name="action" value="uploadAvatar" />
                    <!-- MAX_FILE_SIZE must precede the file input field -->
                    <input type="hidden" name="MAX_FILE_SIZE" value="1048576" />
                    <!-- Name of input element determines name in $_FILES array -->
                    <input id="avatarSelector" name="userfile" type="file" />
                </form>
                <button id="removeAvatarButton">Remove avatar</button>
                
            </div>
            <div id="buttonDiv">
                <button id="deleteAllSavesButton">Delete all saves</button>
                <button id="deleteAccountButton">Delete account</button>
                <button id="hideOverlayButton">Back</button>
            </div>
        </div>
    </body>
</html>